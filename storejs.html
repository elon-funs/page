<!Doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="Let us give attention to technology and economy,facing data and money, some sharing of work and life in my experience.">
    <title>txt_title</title>
    <link rel="stylesheet" href="./css/pure.css">
    <link rel="stylesheet" href="./css/iconfont.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="./css/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="./css/grids-responsive-min.css">
    <!--<![endif]-->    
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="./css/common-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="./css/common.css">
    <!--<![endif]-->
</head>
<body>
  <div class="header">
    <div class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed">
      <a class="bor-r50p menu-logo" href="#">
        <div class="menu-logo-c3 bor-r50p">
          <div class="menu-logo-c5 bor-r50p"></div>
          <div class="menu-logo-c4 bor-r50p"></div>
          <div class="menu-logo-color1">
            <div class="menu-logo-color2"></div>
          </div>
        </div>
      </a>
      <a class="pure-menu-heading" href="/index.html">DataMoney.net</a>
      <a class="pure-menu-mobile icon iconfont" href="/index.html">&#xe64d;</a>
      <ul class="pure-menu-list">
        <li class="pure-menu-item pure-menu-selected"><a href="/" class="pure-menu-link">Home</a></li>
        <li class="pure-menu-item"><a href="/data.html" class="pure-menu-link">Data[Tech]</a></li>
        <li class="pure-menu-item"><a href="/money.html" class="pure-menu-link">Money[Finance]</a></li>
        <li class="pure-menu-item"><a href="/share.html" class="pure-menu-link">Resource[Share]</a></li>
      </ul>
    </div>
  </div>
  <div class="splash-container">
    <div class="splash">
      <h1 class="splash-head">txt_title</h1>
      <p class="splash-subhead">andy发表:txt_time</p>
    </div>
  </div>
  <div class="content-wrapper">
    <div class="ribbon l-box-lrg pure-g">
      <div class="pure-u-1 pure-u-md-1 pure-u-lg-1-1">
      <pre>
        <div class="coderead">cmd shell</div>
        cookie > localstorage(store.js) > indexedDB >  graphql
      </pre>
    </div>
  </div>
</div>
<div class="footer tac">
  &#169; Since 2018 by <a href="#" class="tfcfff">DataMoney.net</a>
</div>
</body>
<!-- storejs -->
<script src="https://cdn.bootcss.com/store.js/1.3.20/store.min.js"></script>
<script type="text/javascript">
// init();
// test();
function test(){
  store.set('andy','anyd');
  store.set('name','heheh');
  console.log(store.get('name'));
  console.log(store.getAll());
  store.forEach(function(key, val) {  
    console.log(key, '==', val);
  });
  store.remove('andy');
  console.log(store.get('name'));
}

function init(){
    if(!store.enabled){
        console.log('failed');
        return;
    }else{
        console.log('it is working ');
    }
}
// <!-- storejs -->
// indexedDB
var db;
var dbName='mydb';
var request = window.indexedDB.open(dbName);
request.onerror = function(event) {
  console.log('failed' + event.target.errorCode);
};
request.onsuccess = function(event) {
  console.log('indexedDB working');
  db = event.target.result;
};
request.onupgradeneeded = function (event) {
  db = event.target.result;
  if (!db.objecttables.contains('table')) { //判断数据库中是否已经存在该名称的数据表
    objectStore = db.createObjectStore('table', { keyPath: 'id',autoIncrement: true }); 
    objectStore.createIndex('name', 'name', { unique: false }); 
    objectStore.createIndex('age', 'age', { unique: true }); 
  }
}

function changeData() {
  var request = db.transaction(['table'], 'readwrite').objectStore('table').add({ id: 1, name: 'leiyin', age: 24});
    // .put({ id: 1, name: 'leiyin', age: 24}); //更新数据
  request.onsuccess = function (event) {
    console.log('数据写入成功');
  };
  request.onerror = function (event) {
    console.log('数据写入失败');
  }
}
// changeData();
function read() {
   var transaction = db.transaction(['table']);
   var objectStore = transaction.objectStore('table');
   var request = objectStore.get(1);
   request.onerror = function(event) {
     console.log('事务失败');
   };
   request.onsuccess = function( event) {
      if (request.result) {
        console.log(request.result);
      } else {
        console.log('未获得数据记录');
      }
   };
}
// read();
var transaction = db.transaction(['table'], 'readonly');
var store = transaction.objectStore('table');
var index = store.index('name');
var request = index.get('leiyin');
request.onsuccess = function (e) {
  var result = e.target.result;
  if (result) {
    // ...
  } else {
    // ...
  }
}
var store = db.transaction('table','readwrite').objectStore('table');
var index = store.index('name');
var request=index.openCursor(IDBKeyRange.only('leiyin'))
request.onerror = function(e){
}
request.onsuccess = function(e){
    console.log('游标开始查询')
    var cursor = e.target.result;
    if(cursor){//必须要检查
        console.log(cursor);
        cursor.continue();//遍历了存储对象中的所有内容
    }else{
        //...
    }
};
function remove() {
  var request = db.transaction(['table'], 'readwrite')
    .objectStore('table')
    .delete(1);
  request.onsuccess = function (event) {
    console.log('数据删除成功');
  };
}
// remove();
function cursorDeldteData(db,table){
    //通过游标删除记录
    var store = db.transaction(table,'readwrite').objectStore(table);
    var request = store.openCursor();
    request.onsuccess = function(e){
        var cursor = e.target.result,
            value,
            deleteRequest;
        if(cursor){
          deleteRequest = cursor.delete();//请求删除当前项
          deleteRequest.onerror = function(){
            console.log('游标删除该记录失败');
          };
          cursor.continue();
        }
    };
}
function clear(db,table){
    //删除存储空间全部记录
    var store = db.transaction(table,'readwrite').objectStore(table);
    store.clear();
    console.log('已删除存储空间'+table+'全部记录');
}
// clear();
// indexedDB.deleteDatabase(DatabaseName); 



// indexedDB
</script>
</html>
